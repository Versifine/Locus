# Locus 任务看板

> 📋 状态说明：⬜ 待办 | 🔄 进行中 | ✅ 完成

---

## In Progress

### T026: 聊天 → LLM → 回复 串联
> 完整闭环：收到玩家消息 → 调 LLM → 注入回复

**步骤**：
1. ⬜ Agent 的 ChatEventHandler 中调用 LLM client
2. ⬜ 异步处理（goroutine），不阻塞事件总线
3. ⬜ LLM 返回后通过注入通道发送回复
4. ⬜ 过滤条件：只响应 SourcePlayer / SourcePlayerSend，忽略系统消息和自己的消息
5. ⬜ 手动测试验证完整链路

---

## Backlog

### v0.3 - LLM 集成 + 聊天回复

> 目标：Agent 能监听聊天、调用 LLM、自动回复到游戏内

#### T026: 聊天 → LLM → 回复 串联
> 完整闭环：收到玩家消息 → 调 LLM → 注入回复

**步骤**：
1. Agent 的 ChatEventHandler 中调用 LLM client
2. 异步处理（goroutine），不阻塞事件总线
3. LLM 返回后通过注入通道发送回复
4. 过滤条件：只响应 SourcePlayer / SourcePlayerSend，忽略系统消息和自己的消息
5. 手动测试验证完整链路

#### T027: 端到端验收
> v0.3 整体验收

**步骤**：
1. 连接真实 MC 服务器，玩家发消息，Agent 回复
2. 验证异步不阻塞代理转发
3. 验证 LLM 超时 / 失败时的降级处理
4. 代码审查 + 提交

---

## Done

### v0.3 - 聊天拦截（阶段性） ✅

- [x] T025: 回复注入通道（SendMsgToServer + ChatCommand 构造 + connCtx 生命周期）✅ (2026-02-07)
- [x] T024: LLM 客户端 + 配置（DeepSeek API 封装 + 单元测试）✅ (2026-02-07)
- [x] T023: Hook 机制框架（事件总线 + Agent 消费者）✅ (2026-02-06)

### v0.3.1 - 代码质量治理 ✅ (2026-02-06)

- [x] T028: 安全与正确性修复（unsafe 移除、连接泄漏、解析中断）✅ (2026-02-06)
- [x] T029: relayPackets 拆分 + 包 ID 常量化 ✅ (2026-02-06)
- [x] T030: 日志配置生效 + ChatMessage 字段命名修正 ✅ (2026-02-06)

- [x] T022: 解析 Player Chat Message (S→C) ✅ (2026-02-06)
- [x] T021: 解析 Chat Message (C→S) ✅ (2026-02-06)
- [x] T020: 解析 System Chat Message (S→C) ✅ (2026-02-06)
- [x] T019: 抓包确认 1.21.11 聊天包 ID ✅ (2026-02-04)

### v0.2.2 - 协议增强 ✅ (2026-02-04)

- [x] T030: 实现协议压缩/解压支持 ✅ (2026-02-04)

### v0.1 - TCP 透明代理 ✅ (2026-01-31)

- [x] T001: 初始化 Go 项目结构
- [x] T002: 实现 YAML 配置加载
- [x] T003: 实现 TCP Listener
- [x] T004: 实现双向流量转发
- [x] T005: 添加日志输出
- [x] T006: 手动测试验证

### v0.2 - 协议解析 ✅ (2026-02-03)

- [x] T007: 实现 VarInt/VarLong 编解码 ✅ (2026-01-31)
- [x] T008: 实现 Packet 读写器 ✅ (2026-02-03)
- [x] T009: 重构 Proxy，接入协议解析（能打印包 ID） ✅ (2026-02-03)
- [x] T010: 解析 Handshake 包 ✅ (2026-02-03)
- [x] T011: 解析 Login Start 包 ✅ (2026-02-03)
- [x] T012: 跟踪连接状态 (Handshaking → Login → Play) ✅ (2026-02-03)

### v0.2.1 - 地基补强 ✅ (2026-02-04)

- [x] T013: 自定义错误类型（protocol 层） ✅ (2026-02-04)
- [x] T014: 日志抽象层（slog） ✅ (2026-02-04)
- [x] T015: config 单元测试 ✅ (2026-02-04)
- [x] T016: proxy 集成测试 ✅ (2026-02-04)
- [x] T017: 优雅关闭（context + 信号处理） ✅ (2026-02-04)
- [x] T018: ConnState 设计评审 ✅ (2026-02-04)
